<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <base target="_top">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 12px; }
    .grid { display: grid; grid-template-columns: 240px 1fr; gap: 8px 10px; }
    input, select { width: 100%; padding: 8px; box-sizing: border-box; }
    .row { margin: 12px 0; }
    button { padding: 9px 14px; margin-right: 8px; }
    .ok{color:#0a0}.err{color:#b00}.muted{color:#777}
    h3{margin:18px 0 8px;font-size:15px}
  </style>
</head>
<body>
  <h2>Credentials</h2>
  <div class="muted">Fill tracking URLs and keys. Save writes to Script Properties.</div>

  <h3>Matkahuolto</h3>
  <div class="grid">
    <label>MH_TRACK_URL</label><input name="MH_TRACK_URL" type="text">
    <label>MH_BASIC (Base64 user:pass)</label><input name="MH_BASIC" type="text">
  </div>

  <h3>Posti</h3>
  <div class="grid">
    <label>POSTI_TOKEN_URL</label><input name="POSTI_TOKEN_URL" type="text">
    <label>POSTI_BASIC (Base64 clientId:secret)</label><input name="POSTI_BASIC" type="text">
    <label>POSTI_TRACK_URL</label><input name="POSTI_TRACK_URL" type="text">
  </div>

  <h3>GLS Finland (x-api-key)</h3>
  <div class="grid">
    <label>GLS_FI_TRACK_URL</label><input name="GLS_FI_TRACK_URL" type="text">
    <label>GLS_FI_API_KEY</label><input name="GLS_FI_API_KEY" type="password">
    <label>GLS_FI_SENDER_ID (optional)</label><input name="GLS_FI_SENDER_ID" type="text">
    <label>GLS_FI_METHOD</label>
    <select name="GLS_FI_METHOD"><option>GET</option><option>POST</option></select>
  </div>

  <h3>GLS OAuth (fallback)</h3>
  <div class="grid">
    <label>GLS_TOKEN_URL</label><input name="GLS_TOKEN_URL" type="text">
    <label>GLS_BASIC (Base64 clientId:secret)</label><input name="GLS_BASIC" type="text">
    <label>GLS_TRACK_URL</label><input name="GLS_TRACK_URL" type="text">
  </div>

  <h3>DHL</h3>
  <div class="grid">
    <label>DHL_TRACK_URL</label><input name="DHL_TRACK_URL" type="text">
    <label>DHL_API_KEY</label><input name="DHL_API_KEY" type="password">
  </div>

  <h3>Bring</h3>
  <div class="grid">
    <label>BRING_TRACK_URL</label><input name="BRING_TRACK_URL" type="text">
    <label>BRING_UID</label><input name="BRING_UID" type="text">
    <label>BRING_KEY</label><input name="BRING_KEY" type="password">
    <label>BRING_CLIENT_URL</label><input name="BRING_CLIENT_URL" type="text">
  </div>

  <h3>Bulk/backoff</h3>
  <div class="grid">
    <label>BULK_BACKOFF_MINUTES_BASE</label><input name="BULK_BACKOFF_MINUTES_BASE" type="text" placeholder="default 5">
  </div>

  <div class="row">
    <button id="save">Save</button>
    <button id="defaults">Fill defaults</button>
    <button id="flush">Flush tracking cache</button>
    <span id="msg" class="muted"></span>
  </div>

  <script>
    (function init(){
      const props = <?= JSON.stringify(props) ?> || {};
      for (const [k,v] of Object.entries(props)){
        const el = document.querySelector(`[name="${k}"]`);
        if (el) el.value = v || '';
      }
    })();

    document.getElementById('save').addEventListener('click', () => {
      const data = {};
      [...document.querySelectorAll('input[name],select[name]')].forEach(el => data[el.name] = el.value);
      const msg = document.getElementById('msg');
      msg.textContent = 'Saving…'; msg.className='muted';
      google.script.run.withSuccessHandler(r => {
        msg.textContent = (r && r.ok) ? 'Saved.' : (r && r.msg || 'Error'); msg.className=(r&&r.ok)?'ok':'err';
      }).credSaveProps(data);
    });

    document.getElementById('defaults').addEventListener('click', () => {
      const msg = document.getElementById('msg');
      msg.textContent = 'Applying defaults…'; msg.className='muted';
      google.script.run.withSuccessHandler(() => { msg.textContent = 'Defaults applied.'; msg.className='ok'; }).seedKnownAccountsAndKeys();
    });

    document.getElementById('flush').addEventListener('click', () => {
      const msg = document.getElementById('msg');
      msg.textContent = 'Flushing cache…'; msg.className='muted';
      google.script.run.withSuccessHandler(() => { msg.textContent = 'Cache flushed.'; msg.className='ok'; }).trkClearCache();
    });
  </script>
</body>
</html>